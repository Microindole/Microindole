name: Generate Metrics
on:
  schedule:
    - cron: "0 16 * * *"
  workflow_dispatch:
  push:
    branches: ["main"]

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Generate GitHub Metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

          # ------------------------------------------------
          # 1. 布局设置
          # ------------------------------------------------
          # 开启宽屏模式，让统计和语言左右排列
          config_display: large
          config_timezone: Asia/Shanghai

          # ------------------------------------------------
          # 2. 基础数据 (精简版)
          # ------------------------------------------------
          # 只保留 'repositories'，这样能显示仓库总数等核心数据
          # 去掉了 'metadata' 和其他导致满屏 "0" 的模块
          base: repositories
          
          # ------------------------------------------------
          # 3. 语言统计 (长条图版)
          # ------------------------------------------------
          plugin_languages: yes
          # 忽略 html 和 css，只看编程语言
          plugin_languages_ignored: html, css
          # 强制显示“最常用语言”部分
          plugin_languages_sections: most-used
          # 显示百分比数字 (让数据更直观)
          plugin_languages_details: percentage
          plugin_languages_limit: 8

          # ------------------------------------------------
          # 4. 图形化插件 (已移除报错的 habits)
          # ------------------------------------------------
          # 代码行数趋势图 (看起来很专业且不报错)
          plugin_lines: yes
          
          # ------------------------------------------------
          # 5. 输出设置
          # ------------------------------------------------
          output_action: commit
          committer_branch: output
          committer_message: "chore: update metrics"
          filename: github-metrics.svg
